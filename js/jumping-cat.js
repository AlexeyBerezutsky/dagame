var Boot=function(){return function(a){this.init=function(){a.input.maxPointers=1,a.stage.disableVisibilityChange=!0,a.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,a.scale.windowConstraints.bottom="visual",a.scale.pageAlignHorizontally=!0,a.scale.pageAlignVertically=!0,a.device.desktop||(a.scale.setMinMax(480,260,1024,768),a.scale.forceLandscape=!0,a.scale.pageAlignHorizontally=!0)},this.preload=function(){a.load.image("tile","img/tile.png"),a.load.image("brick","img/brick.png"),a.load.image("fireball","img/fireball.png"),a.load.spritesheet("baddie","img/baddie.png",32,32,4)},this.create=function(){a.state.start("Game")}}}(),Builder=function(a){return function(b){var c=this;c.game=b;var d=new a,e=function(){var a=c.game.add.sprite(c.game.world.centerX,c.game.world.height-7*d.BASE_SIZE,"baddie");return a.isRunning=!1,a.scale.set(2),a.anchor.setTo(.5,1),c.game.physics.arcade.enable(a),a.body.gravity.y=d.PLAYER_GRAVITY,a.body.collideWorldBounds=!0,a.animations.add("left",[1,0],10,!0),a.animations.add("right",[3,2],10,!0),a.frame=1,a.body.bounce.set(d.PLAYER_BOUNCE),a.friction=function(){this.isRunning||(a.body.velocity.x>d.PLAYER_VELOCITY_TRESHOLD?a.body.velocity.x-=d.PLAYER_MAX_HORISONTAL_VELOCITY/d.PLAYER_FRICTION_COEFFITIENT:a.body.velocity.x<-d.PLAYER_VELOCITY_TRESHOLD&&(a.body.velocity.x+=d.PLAYER_MAX_HORISONTAL_VELOCITY/d.PLAYER_FRICTION_COEFFITIENT))},a.animation=function(){this.isRunning?this.body.velocity.x>d.PLAYER_VELOCITY_TRESHOLD?this.animations.play("right"):this.body.velocity.x<-d.PLAYER_VELOCITY_TRESHOLD&&this.animations.play("left"):(this.animations.stop(),this.body.velocity.x>.01?this.frame=2:this.body.velocity.x<-.01&&(this.frame=1))},a},f=function(){var a=c.game.add.group();return a.enableBody=!0,a.createMultiple(d.TILE_CACHE_SIZE,"tile"),a.addAt=function(a,b){var c=this.getFirstDead();c.reset(a,b),c.body.velocity.y=d.PLATFORM_SPEED,c.body.immovable=!0,c.checkWorldBounds=!0,c.outOfBoundsKill=!0},a},g=function(){var a=c.game.add.group();return a.enableBody=!0,a.createMultiple(d.BRICK_CACHE_SIZE,"brick"),a.addAt=function(a,b){var c=this.getFirstDead();c.reset(a,b),c.body.velocity.y=d.PLATFORM_SPEED,c.body.immovable=!0,c.checkWorldBounds=!0,c.outOfBoundsKill=!0},a},h=function(a){"undefined"==typeof a.verticalPosition&&(a.verticalPosition=-d.BASE_SIZE,a.triggerOnLap());for(var c=Math.ceil(b.world.width/d.BASE_SIZE),e=Math.floor(Math.random()*(c-3))+1,f=-1;f<=c;f++)f!=e&&f!=e+1?a.tiles.addAt(f*d.BASE_SIZE,a.verticalPosition):Math.floor(10*Math.random())+1>d.BRICK_APPEAR_RATE&&a.bricks.addAt(f*d.BASE_SIZE,a.verticalPosition)},i=function(){for(var a=c.game.add.group(),e=0;e<d.NUMBER_OF_BULLETS;e++){var f=c.game.add.sprite(0,0,"fireball");f.scale.set(.05),a.add(f),f.anchor.setTo(.5,.5),c.game.physics.arcade.enable(f),f.body.gravity.y=d.BULLET_GRAVITY,f.body.bounce.set(d.BULLET_BOUNCE),f.kill()}return a.shoot=function(c,e){var f;if(void 0===f&&(f=0),!(b.time.now-f<d.SHOT_DELAY)){f=b.time.now;var g=a.getFirstDead();null!==g&&void 0!==g&&(g.revive(),g.outOfBoundsKill=!0,g.reset(c,e),g.body.velocity.x=0,g.body.velocity.y=-d.BULLET_SPEED)}},a},j=function(){var a={value:0,label:""};a.label=b.add.text(b.world.centerX,100,"0",{font:d.SCORE_FONT,fill:d.SCORE_COLOR}),a.label.anchor.setTo(.5,.5),a.label.align=d.SCORE_ALIGN;var c=function(){this.value+=d.SCORE_INCREMENT,this.label.text=a.value};return a.increment=c.bind(a),a},k={player:e,tiles:f,bricks:g,platforms:h,bullets:i,score:j};c.build=function(a,b){return k[a](b)}}}(Config),Config=new function(){return function(){var a=this;a.PLATFORM_SPEED=80,a.PLATFORM_CREATE_FREQ=3e3,a.PLAYER_GRAVITY=2e3,a.PLAYER_BOUNCE=.1,a.PLAYER_MAX_VERTICAL_VELOCITY=3e3,a.PLAYER_MAX_HORISONTAL_VELOCITY=500,a.PLAYER_FRICTION_COEFFITIENT=100,a.PLAYER_VELOCITY_TRESHOLD=100,a.SHOT_DELAY=10,a.BULLET_SPEED=700,a.NUMBER_OF_BULLETS=20,a.BULLET_GRAVITY=500,a.BULLET_BOUNCE=.8,a.BACKGROUND_COLOR="479cde",a.PHYSICS=Phaser.Physics.ARCADE,a.BRICK_CACHE_SIZE=10,a.TILE_CACHE_SIZE=250,a.CAMERA_AMP=.05,a.CAMERA_DURATION=500,a.BRICK_APPEAR_RATE=8,a.SCORE_FONT="100px Arial",a.SCORE_ALIGN="center",a.SCORE_COLOR="#fff",a.SCORE_INCREMENT=1,a.BASE_SIZE=64}},Game=function(a,b,c){return function(d){var e,f,g,h,i,j,k,l,m,n;this.init=function(){e=new a,f=new b(d),g=new c(d),d.stage.backgroundColor=e.BACKGROUND_COLOR,d.physics.startSystem(e.PHYSICS)},this.create=function(){k=f.build("tiles"),l=f.build("bricks"),i=f.build("bullets"),h=f.build("player"),j=f.build("score"),o(),p(),n=q(function(){f.build("platforms",{tiles:k,bricks:l,triggerOnLap:j.increment})})};var o=function(){g.initPad({onRightTrigger:function(a,b){h.body.wasTouching.down&&(m=!1,h.body.velocity.y=-b*e.PLAYER_MAX_VERTICAL_VELOCITY)},onStickAxisChanged:function(a,b,c){c<-.1?(h.isRunning=!0,h.body.velocity.x=c*e.PLAYER_MAX_HORISONTAL_VELOCITY):c>.1?(h.isRunning=!0,h.body.velocity.x=c*e.PLAYER_MAX_HORISONTAL_VELOCITY):h.isRunning=!1},onAButtonDown:function(){i.shoot(h.body.x+e.BASE_SIZE/2,h.body.y-e.BASE_SIZE/2)}}),g.initKeyboard({onDownKeyCallback:function(a){switch(a.keyCode){case Phaser.KeyCode.UP:h.body.wasTouching.down&&(h.isRunning=!1,h.body.velocity.y=-e.PLAYER_MAX_VERTICAL_VELOCITY/2);break;case Phaser.KeyCode.RIGHT:h.isRunning=!0,h.body.velocity.x=e.PLAYER_MAX_HORISONTAL_VELOCITY/2;break;case Phaser.KeyCode.LEFT:h.isRunning=!0,h.body.velocity.x=-e.PLAYER_MAX_HORISONTAL_VELOCITY/2;break;case Phaser.KeyCode.SPACEBAR:i.shoot(h.body.x+e.BASE_SIZE/2,h.body.y-e.BASE_SIZE/2)}},onUpKeyboard:function(a){[Phaser.KeyCode.RIGHT,Phaser.KeyCode.LEFT].indexOf(a.keyCode)!==-1&&(h.isRunning=!1)}})},p=function(){for(var a=3*e.BASE_SIZE,b=d.world.height-e.BASE_SIZE,c=e.BASE_SIZE,g=b;g>c-e.BASE_SIZE;g-=a)f.build("platforms",{verticalPosition:g,tiles:k,bricks:l,triggerOnLap:j.increment})},q=function(a){return d.time.events.loop(e.PLATFORM_CREATE_FREQ,a,this)};this.update=function(){r(),t(),h.friction(),h.animation()};var r=function(){d.physics.arcade.collide(h,k),d.physics.arcade.collide(k,i),d.physics.arcade.collide(l,h),d.physics.arcade.overlap(l,i,s,null,d)},s=function(a,b){a.kill(),b.kill(),d.camera.shake(e.CAMERA_AMP,e.CAMERA_DURATION)},t=function(){h.body.position.y>=d.world.height-h.body.height&&u()},u=function(){n.timer.removeAll(),d.state.start("Game")}}}(Config,Builder,Inputs),init=function(){var a=new Phaser.Game(800,600,Phaser.AUTO,"gameContainer");a.state.add("Boot",Boot),a.state.add("Game",Game),a.state.start("Boot")},Inputs=function(){return function(a){var b=this;b.game=a,b.initPad=function(a){var c=b.game.input.gamepad;if(c.start(),c.supported&&c.active){var d=c.pad1;if(d)return d.addCallbacks(this,{onConnect:function(){var b=d.getButton(Phaser.Gamepad.XBOX360_RIGHT_TRIGGER);b.onFloat.add(a.onRightTrigger),d.addCallbacks(this,{onAxis:a.onStickAxisChanged});var c=d.getButton(Phaser.Gamepad.XBOX360_A);c.onDown.add(a.onAButtonDown)}}),d;console.log("can not find first gamepad")}else console.log("Gamepad is not supported")},b.initKeyboard=function(b){var c=a.input.keyboard;return c.onDownCallback=b.onDownKeyCallback,c.onUpCallback=b.onUpKeyboard,c}}}();